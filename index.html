<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Arabic Calligraphy Generator â€” Fixed</title>

    <!-- Google fonts (many included for demo) -->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Aref+Ruqaa:wght@400;700&family=Rakkas&family=Lateef:wght@400;700&family=Scheherazade+New:wght@400;700&family=Katibeh&family=Marhey:wght@400;700&family=Markazi+Text:wght@400;700&family=Mirza:wght@400;700&family=Reem+Kufi:wght@400;700&family=Tajawal:wght@400;700&family=Cairo:wght@400;700&family=Changa:wght@400;700&family=Almarai:wght@400;700&family=Lalezar&family=Harmattan:wght@400;700&family=El+Messiri:wght@400;700&family=Jomhuria&family=Baloo+Bhaijaan+2:wght@400;700&family=Kufam:wght@400;700&family=Mada:wght@400;700&family=IBM+Plex+Sans+Arabic:wght@400;700&family=Readex+Pro:wght@400;700&family=Noto+Kufi+Arabic:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">

    <!-- html2canvas for screenshot/export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* --- layout & design (kept from your original, with small tweaks) --- */
        * { box-sizing: border-box; margin:0; padding:0; }
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh;
            padding:20px;
            direction: rtl;
            color: #222;
        }
        .container {
            max-width:1400px;
            margin:0 auto;
            background:#fff;
            border-radius:16px;
            box-shadow:0 20px 60px rgba(0,0,0,0.25);
            overflow:hidden;
        }
        .header {
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:#fff;
            padding:34px 24px;
            text-align:center;
        }
        .header h1 { font-size:2.2rem; margin-bottom:6px; font-weight:700; }
        .header p { opacity:.95; margin-top:4px; font-size:1rem; }

        .main-content {
            display:grid;
            grid-template-columns: 380px 1fr 320px;
            gap:0;
            min-height:640px;
        }

        .controls, .sidebar {
            background:#f8f9fa;
            padding:22px;
            overflow-y:auto;
            max-height:900px;
        }

        .controls { border-left: 2px solid #e6e6e6; }
        .sidebar { border-right: 2px solid #e6e6e6; }

        .control-group { margin-bottom:20px; }
        .control-group label { display:block; margin-bottom:8px; font-weight:700; color:#333; font-size:0.95em; }

        .label-badge { display:inline-block; background:#667eea; color:#fff; padding:2px 8px; border-radius:6px; font-size:0.78em; margin-left:6px; }

        textarea { width:100%; padding:12px; border:2px solid #ddd; border-radius:8px; font-size:1.05rem; min-height:120px; resize:vertical; direction:rtl; font-family: 'Cairo', sans-serif; }
        textarea:focus { border-color:#667eea; outline:none; }

        .char-count { text-align:left; font-size:0.85em; color:#666; margin-top:6px; }

        .quick-examples { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:10px; }
        .example-btn { padding:8px 10px; background:#fff; border:1px solid #ddd; border-radius:6px; cursor:pointer; font-size:0.9rem; }
        .example-btn:hover { border-color:#667eea; transform:translateY(-2px); }

        select { width:100%; padding:10px; border-radius:8px; border:2px solid #ddd; background:#fff; }
        .font-preview { background:#fff; padding:12px; border-radius:8px; border:1px solid #e6e6e6; margin-top:10px; }
        .font-preview-text { font-size:1.3rem; margin-bottom:8px; text-align:center; }

        .size-buttons { display:grid; grid-template-columns: repeat(4,1fr); gap:8px; margin-bottom:10px; }
        .size-btn { padding:10px; border-radius:8px; border:1px solid #ddd; background:#fff; font-weight:700; cursor:pointer; }
        .size-btn.active { background:#667eea; color:#fff; border-color:#667eea; transform:translateY(-2px); }

        input[type=range] { width:100%; margin-top:6px; }

        .color-section { background:#fff; padding:12px; border-radius:8px; border:1px solid #e6e6e6; margin-bottom:12px; }
        .color-input-group { display:flex; gap:12px; align-items:center; }
        input[type=color] { width:60px; height:40px; border:1px solid #ddd; border-radius:6px; cursor:pointer; }
        .color-value { flex:1; padding:8px; background:#f8f9fa; border-radius:6px; font-family: monospace; font-size:.92rem; }

        .quick-colors { display:grid; grid-template-columns:repeat(6,1fr); gap:8px; margin-top:8px; }
        .quick-color { height:40px; border-radius:6px; cursor:pointer; border:2px solid transparent; transition:all .18s; }
        .quick-color:hover { transform:scale(1.05); border-color:#333; }

        .checkbox-group { display:flex; gap:10px; align-items:center; padding:8px; background:#fff; border-radius:8px; border:1px solid #e6e6e6; }

        .align-buttons { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:8px; }
        .align-btn { padding:10px; border-radius:8px; background:#fff; border:1px solid #ddd; cursor:pointer; font-weight:700; }
        .align-btn.active { background:#667eea; color:#fff; border-color:#667eea; transform:translateY(-2px); }

        .preview-area { padding:30px; display:flex; align-items:center; justify-content:center; background:#ffffff; min-height:520px; }
        #preview {
            padding:40px;
            border-radius:12px;
            min-height:300px;
            display:flex;
            align-items:center;
            justify-content:center;
            text-align:right;
            transition:all .2s;
            max-width:100%;
            word-wrap:break-word;
            box-shadow:0 12px 30px rgba(0,0,0,0.08);
            /* default background white */
            background: #ffffff;
        }

        .button-group { display:grid; gap:10px; margin-top:12px; }
        button { padding:12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; font-size:0.95rem; }
        .btn-primary { background:linear-gradient(135deg,#667eea 0%, #764ba2 100%); color:#fff; }
        .btn-success { background:#28a745; color:#fff; }

        .sidebar .section-title { font-size:1.05rem; font-weight:700; margin-bottom:12px; padding-bottom:8px; border-bottom:2px solid #eee; }
        .stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px; }
        .stat-card { background:#fff; padding:12px; border-radius:8px; text-align:center; border:1px solid #e6e6e6; }
        .stat-value { font-size:1.5rem; font-weight:800; color:#667eea; }
        .stat-label { font-size:.9rem; color:#666; margin-top:6px; }

        .info-box { background:#e7f3ff; border-right:4px solid #2196F3; padding:12px; border-radius:8px; margin-bottom:12px; font-size:.95rem; color:#333; }
        .info-box h4 { color:#1976D2; margin-bottom:8px; }

        @media (max-width:1200px) {
            .main-content { grid-template-columns: 1fr; }
            .controls, .sidebar { border:none; border-top:2px solid #e6e6e6; max-height:none; }
            .preview-area { min-height:420px; padding:18px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</h1>
            <p>Ø£Ù†Ø´Ø¦ ØªØµØ§Ù…ÙŠÙ… Ø®Ø·ÙŠØ© Ø¹Ø±Ø¨ÙŠØ© Ø¬Ù…ÙŠÙ„Ø© Ù…Ø¹ Ø£ÙƒØ«Ø± Ù…Ù† 30 Ø®Ø· Ø§Ø­ØªØ±Ø§ÙÙŠ â€” Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙˆØ±ÙŠØ© ÙˆØªØµØ¯ÙŠØ± PNG / JPG</p>
        </div>

        <div class="main-content">
            <!-- LEFT: CONTROLS -->
            <div class="controls">
                <div class="control-group">
                    <label><span class="label-badge">RTL</span> Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ <span class="label-badge">ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ</span></label>
                    <textarea id="arabicText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù‡Ù†Ø§...">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…</textarea>
                    <div class="char-count">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù: <span id="charCount">0</span></div>
                    <a href="https://www.branah.com/arabic" target="_blank" rel="noopener" class="help-link">Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŸ</a>
                </div>

                <div class="control-group">
                    <label><span class="label-badge">Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</span> Ø£Ù…Ø«Ù„Ø© Ø³Ø±ÙŠØ¹Ø©</label>
                    <div class="quick-examples" id="quickExamples"></div>
                </div>

                <div class="control-group">
                    <label><span class="label-badge">30+ Ø®Ø·</span> Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø®Ø·</label>
                    <select id="fontFamily" aria-label="Ø§Ø®ØªØ± Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø®Ø·">
                        <optgroup label="Ø®Ø·ÙˆØ· ØªÙ‚Ù„ÙŠØ¯ÙŠØ©">
                            <option value="Amiri">Ø£Ù…ÙŠØ±ÙŠ - Amiri</option>
                            <option value="Aref Ruqaa">Ø¹Ø§Ø±Ù Ø±Ù‚Ø¹Ø© - Aref Ruqaa</option>
                            <option value="Rakkas">Ø±Ù‚Ù‘Ø§Øµ - Rakkas</option>
                            <option value="Lateef">Ù„Ø·ÙŠÙ - Lateef</option>
                            <option value="Scheherazade New">Ø´Ù‡Ø±Ø²Ø§Ø¯ - Scheherazade</option>
                            <option value="Katibeh">ÙƒØ§ØªØ¨Ø© - Katibeh</option>
                        </optgroup>
                        <optgroup label="Ø®Ø·ÙˆØ· ÙƒÙˆÙÙŠØ©">
                            <option value="Reem Kufi">Ø±ÙŠÙ… ÙƒÙˆÙÙŠ - Reem Kufi</option>
                            <option value="Noto Kufi Arabic">Ù†ÙˆØªÙˆ ÙƒÙˆÙÙŠ - Noto Kufi</option>
                            <option value="Kufam">ÙƒÙˆÙØ§Ù… - Kufam</option>
                        </optgroup>
                        <optgroup label="Ø®Ø·ÙˆØ· Ù†Ø³Ø®">
                            <option value="Noto Naskh Arabic">Ù†ÙˆØªÙˆ Ù†Ø³Ø® - Noto Naskh</option>
                        </optgroup>
                        <optgroup label="Ø®Ø·ÙˆØ· Ø­Ø¯ÙŠØ«Ø©">
                            <option value="Cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© - Cairo</option>
                            <option value="Tajawal">ØªØ¬ÙˆØ§Ù„ - Tajawal</option>
                            <option value="Almarai">Ø§Ù„Ù…Ø±Ø¹ÙŠ - Almarai</option>
                            <option value="Changa">Ø´Ù†Ù‚Ø§ - Changa</option>
                            <option value="Marhey">Ù…Ø±Ø­ÙŠ - Marhey</option>
                            <option value="Harmattan">Ù‡Ø±Ù…ØªØ§Ù† - Harmattan</option>
                            <option value="El Messiri">Ø§Ù„Ù…Ø³ÙŠØ±ÙŠ - El Messiri</option>
                            <option value="Mada">Ù…Ø¯Ù‰ - Mada</option>
                            <option value="Readex Pro">Ø±ÙŠØ¯ÙƒØ³ Ø¨Ø±Ùˆ - Readex Pro</option>
                            <option value="IBM Plex Sans Arabic">IBM Ø¹Ø±Ø¨ÙŠ - IBM Plex</option>
                        </optgroup>
                        <optgroup label="Ø®Ø·ÙˆØ· Ø²Ø®Ø±ÙÙŠØ©">
                            <option value="Lalezar">Ù„Ø§Ù„Ø²Ø§Ø± - Lalezar</option>
                            <option value="Jomhuria">Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© - Jomhuria</option>
                            <option value="Vibes">ÙØ§ÙŠØ¨Ø³ - Vibes</option>
                            <option value="Blaka">Ø¨Ù„Ø§ÙƒØ§ - Blaka</option>
                            <option value="Baloo Bhaijaan 2">Ø¨Ø§Ù„Ùˆ Ø¨Ù‡Ø§ÙŠØ¬Ø§Ù† - Baloo</option>
                        </optgroup>
                        <optgroup label="Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ·">
                            <option value="Markazi Text">Ù…Ø±ÙƒØ²ÙŠ - Markazi Text</option>
                            <option value="Mirza">Ù…ÙŠØ±Ø²Ø§ - Mirza</option>
                            <option value="Reem Kufi">Ø±ÙŠÙ… ÙƒÙˆÙÙŠ - Reem Kufi</option>
                        </optgroup>
                    </select>
                </div>

                <div class="font-preview">
                    <div class="font-preview-text" id="fontPreviewText">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…</div>
                    <div class="font-description" id="fontDescription">
                        <strong>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: Amiri</strong><br>
                        Ø®Ø· Ø¹Ø±Ø¨ÙŠ ØªÙ‚Ù„ÙŠØ¯ÙŠ Ø£Ù†ÙŠÙ‚ - Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ø²Ø®Ø±ÙÙŠØ© ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
                    </div>
                </div>

                <div class="control-group">
                    <label>Ø­Ø¬Ù… Ø§Ù„Ø®Ø·: <span id="fontSizeValue">48</span>px</label>
                    <div class="size-buttons" id="sizeButtons">
                        <button class="size-btn" data-size="24">S</button>
                        <button class="size-btn active" data-size="48">M</button>
                        <button class="size-btn" data-size="72">L</button>
                        <button class="size-btn" data-size="96">XL</button>
                    </div>
                    <input type="range" id="fontSize" min="20" max="260" value="48">
                </div>

                <div class="control-group">
                    <div class="section-title">Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø·</div>

                    <div class="color-section">
                        <label>Ù„ÙˆÙ† Ø§Ù„Ù†Øµ</label>
                        <div class="color-input-group">
                            <input type="color" id="textColor" value="#000000">
                            <div class="color-value" id="textColorValue">#000000</div>
                        </div>
                    </div>

                    <div class="checkbox-group" style="margin-top:10px;">
                        <input type="checkbox" id="transparentBg">
                        <label for="transparentBg">Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ©</label>
                    </div>

                    <div class="color-section">
                        <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© <span style="font-size:0.85em;color:#666;">(Ø§Ù†Ù‚Ø± Ø´ÙØ§Ù Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©)</span></label>
                        <div class="color-input-group">
                            <input type="color" id="bgColor" value="#ffffff">
                            <div class="color-value" id="bgColorValue">#ffffff</div>
                        </div>
                    </div>

                    <label>Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</label>
                    <div class="quick-colors" id="quickColors">
                        <div class="quick-color" data-color="#000000" style="background:#000000;"></div>
                        <div class="quick-color" data-color="#8B4513" style="background:#8B4513;"></div>
                        <div class="quick-color" data-color="#006400" style="background:#006400;"></div>
                        <div class="quick-color" data-color="#DC143C" style="background:#DC143C;"></div>
                        <div class="quick-color" data-color="#FFD700" style="background:#FFD700;"></div>
                        <div class="quick-color" data-color="#4B0082" style="background:#4B0082;"></div>
                    </div>
                </div>

                <div class="control-group">
                    <label><span class="label-badge">RTL Ø¬Ø§Ù‡Ø²</span> Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ</label>
                    <div class="align-buttons" id="alignButtons">
                        <button class="align-btn active" data-align="right">ÙŠÙ…ÙŠÙ†</button>
                        <button class="align-btn" data-align="center">ÙˆØ³Ø·</button>
                        <button class="align-btn" data-align="left">ÙŠØ³Ø§Ø±</button>
                    </div>
                    <div style="font-size:0.85rem;color:#666;margin-top:8px;text-align:center">Ø§Ù„Ø­Ø§Ù„ÙŠ: ØªØ¯ÙÙ‚ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±</div>
                </div>

                <div class="button-group">
                    <button class="btn-primary" id="downloadPng">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ PNG (Ø´ÙØ§Ù)</button>
                    <button class="btn-success" id="downloadJpg">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ JPG (Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡)</button>
                </div>
            </div>

            <!-- CENTER: PREVIEW -->
            <div class="preview-area">
                <div id="preview" role="img" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø®Ø·">
                    Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
                </div>
            </div>

            <!-- RIGHT: SUMMARY / SIDEBAR -->
            <div class="sidebar">
                <div class="section-title">Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª <span class="label-badge">Ù…Ø¨Ø§Ø´Ø±</span></div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="statChars">0</div>
                        <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statSize">48px</div>
                        <div class="stat-label">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statAlign">ÙŠÙ…ÙŠÙ†</div>
                        <div class="stat-label">Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statBg">ØµÙ„Ø¨</div>
                        <div class="stat-label">Ø§Ù„Ø®Ù„ÙÙŠØ©</div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©:</h4>
                    <ul>
                        <li>â€¢ Ø´ÙØ§Ù: Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ±Ø§ÙƒØ¨Ø§Øª</li>
                        <li>â€¢ Ø£Ù„ÙˆØ§Ù† ØµÙ„Ø¨Ø©: Ø§Ù„Ø£ÙØ¶Ù„ Ù„Ù„ØªØµØ§Ù…ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø©</li>
                        <li>â€¢ ØµÙŠØºØ© PNG ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙØ§ÙÙŠØ©</li>
                        <li>â€¢ ØµÙŠØºØ© JPG ØªØ³ØªØ®Ø¯Ù… Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡</li>
                    </ul>
                </div>

                <div class="info-box">
                    <h4>Ù†ØµØ§Ø¦Ø­ Ø§Ù„ØªØµØ¯ÙŠØ±:</h4>
                    <ul>
                        <li>â€¢ PNG Ù„Ù„ÙˆÙŠØ¨ ÙˆÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„</li>
                        <li>â€¢ JPG Ù„Ø£Ø­Ø¬Ø§Ù… Ù…Ù„ÙØ§Øª Ø£ØµØºØ±</li>
                        <li>â€¢ Ø§Ù„ØªØ¨Ø§ÙŠÙ† Ø§Ù„Ø¹Ø§Ù„ÙŠ ÙŠØ­Ø³Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</li>
                        <li>â€¢ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ø´ÙØ§ÙØ© Ø±Ø§Ø¦Ø¹Ø© Ù„Ù„Ø´Ø¹Ø§Ø±Ø§Øª</li>
                    </ul>
                </div>

                <div class="info-box" style="background:#fff3cd;border-right-color:#ffc107;">
                    <h4>Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h4>
                    <div id="currentBgInfo" style="font-family:monospace;font-size:1.05rem;font-weight:700;color:#856404;">#ffffff</div>
                    <div style="margin-top:8px;font-size:0.92rem">Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© ØµÙ„Ø¨. ÙŠØ¹Ù…Ù„ Ù…Ø¹ ØµÙŠØºØªÙŠ PNG Ùˆ JPG.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ---------- grab DOM ---------- */
        const arabicText = document.getElementById('arabicText');
        const fontFamily = document.getElementById('fontFamily');
        const fontSize = document.getElementById('fontSize');
        const fontSizeValue = document.getElementById('fontSizeValue');
        const textColor = document.getElementById('textColor');
        const textColorValue = document.getElementById('textColorValue');
        const bgColor = document.getElementById('bgColor');
        const bgColorValue = document.getElementById('bgColorValue');
        const transparentBg = document.getElementById('transparentBg');
        const preview = document.getElementById('preview');
        const charCount = document.getElementById('charCount');
        const fontPreviewText = document.getElementById('fontPreviewText');
        const fontDescription = document.getElementById('fontDescription');
        const currentBgInfo = document.getElementById('currentBgInfo');
        const statChars = document.getElementById('statChars');
        const statSize = document.getElementById('statSize');
        const statAlign = document.getElementById('statAlign');
        const statBg = document.getElementById('statBg');

        const quickExamplesContainer = document.getElementById('quickExamples');
        const quickColors = Array.from(document.querySelectorAll('.quick-color'));
        const sizeButtons = Array.from(document.querySelectorAll('.size-btn'));
        const alignButtons = Array.from(document.querySelectorAll('.align-btn'));
        const downloadPng = document.getElementById('downloadPng');
        const downloadJpg = document.getElementById('downloadJpg');

        /* ---------- initial data ---------- */
        const examples = ['Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…', 'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ø±Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ†', 'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡', 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡', 'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±', 'Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡'];
        const fontDescriptions = {
            'Amiri': 'Ø®Ø· Ø¹Ø±Ø¨ÙŠ ØªÙ‚Ù„ÙŠØ¯ÙŠ Ø£Ù†ÙŠÙ‚ - Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ø²Ø®Ø±ÙÙŠØ© ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†',
            'Aref Ruqaa': 'Ø®Ø· Ø§Ù„Ø±Ù‚Ø¹Ø© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ - Ù…Ù‚Ø±ÙˆØ¡ ÙˆØ¬Ù…ÙŠÙ„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ',
            'Rakkas': 'Ø®Ø· Ø²Ø®Ø±ÙÙŠ Ø¬Ø°Ø§Ø¨ - Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø´Ø¹Ø§Ø±Ø§Øª',
            'Lateef': 'Ø®Ø· Ù†Ø³Ø® ØªÙ‚Ù„ÙŠØ¯ÙŠ - ÙˆØ§Ø¶Ø­ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ø·ÙˆÙŠÙ„Ø©',
            'Scheherazade New': 'Ø®Ø· Ø´Ù‡Ø±Ø²Ø§Ø¯ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ - Ø£Ù†ÙŠÙ‚ ÙˆÙ…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª',
            'Cairo': 'Ø®Ø· Ø­Ø¯ÙŠØ« ÙˆØ¹ØµØ±ÙŠ - Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„ØªØµØ§Ù…ÙŠÙ… Ø§Ù„Ù…Ø¹Ø§ØµØ±Ø©',
            'Reem Kufi': 'Ø®Ø· ÙƒÙˆÙÙŠ Ù‡Ù†Ø¯Ø³ÙŠ - Ù‚ÙˆÙŠ ÙˆØ­Ø¯ÙŠØ«',
            'Tajawal': 'Ø®Ø· Ø¹ØµØ±ÙŠ Ù†Ø¸ÙŠÙ - Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª',
            'Almarai': 'Ø®Ø· Ø§Ù„Ù…Ø±Ø¹ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ« - ÙˆØ§Ø¶Ø­ ÙˆØ¹ØµØ±ÙŠ',
            'Changa': 'Ø®Ø· Ø´Ù†Ù‚Ø§ - Ù‚ÙˆÙŠ ÙˆØ¬Ø°Ø§Ø¨',
            'Marhey': 'Ø®Ø· Ù…Ø±Ø­ÙŠ - ÙØ±ÙŠØ¯ ÙˆÙ…Ù…ÙŠØ²',
            'Harmattan': 'Ø®Ø· Ù‡Ø±Ù…ØªØ§Ù† - Ø£Ù†ÙŠÙ‚ ÙˆÙ…Ù‚Ø±ÙˆØ¡',
            'El Messiri': 'Ø®Ø· Ø§Ù„Ù…Ø³ÙŠØ±ÙŠ - ØªÙ‚Ù„ÙŠØ¯ÙŠ Ø¬Ù…ÙŠÙ„'
        };

        /* ---------- helpers ---------- */
        function safeFontFamily(name) {
            // quote names that have spaces so CSS font-family works
            if (/\s/.test(name)) return `"${name}"`;
            return name;
        }

        function countChars(str) {
            // basic char count; this is good enough for UI
            return Array.from(str).length;
        }

        /* ---------- populate quick examples ---------- */
        examples.forEach(ex => {
            const btn = document.createElement('button');
            btn.className = 'example-btn';
            btn.type = 'button';
            btn.textContent = ex;
            btn.addEventListener('click', () => {
                arabicText.value = ex;
                updatePreview();
            });
            quickExamplesContainer.appendChild(btn);
        });

        /* ---------- wire quick colors ---------- */
        quickColors.forEach(el => {
            el.addEventListener('click', () => {
                const color = el.dataset.color || window.getComputedStyle(el).backgroundColor;
                textColor.value = color;
                textColorValue.textContent = color;
                updatePreview();
            });
        });

        /* ---------- size buttons logic ---------- */
        sizeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                sizeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const s = parseInt(btn.dataset.size, 10) || 48;
                fontSize.value = s;
                fontSizeValue.textContent = s;
                updatePreview();
            });
        });

        /* ---------- align buttons logic ---------- */
        alignButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                alignButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const align = btn.dataset.align || 'right';
                preview.style.textAlign = align;
                updatePreview(); // updates statAlign as well
            });
        });

        /* ---------- event listeners for main inputs ---------- */
        arabicText.addEventListener('input', updatePreview);
        fontFamily.addEventListener('change', updatePreview);
        fontSize.addEventListener('input', () => {
            fontSizeValue.textContent = fontSize.value;
            // set size buttons active if matching
            sizeButtons.forEach(b => {
                if (String(b.dataset.size) === String(fontSize.value)) {
                    sizeButtons.forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                }
            });
            updatePreview();
        });
        textColor.addEventListener('input', () => {
            textColorValue.textContent = textColor.value;
            updatePreview();
        });
        bgColor.addEventListener('input', () => {
            bgColorValue.textContent = bgColor.value;
            updatePreview();
        });
        transparentBg.addEventListener('change', updatePreview);

        /* ---------- preview & stats ---------- */
        function updatePreview() {
            const text = arabicText.value || '';
            // set content safely
            preview.textContent = text || 'Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§';
            // set font family (quote if needed)
            preview.style.fontFamily = `${safeFontFamily(fontFamily.value)}, sans-serif`;
            document.getElementById('fontPreviewText').style.fontFamily = preview.style.fontFamily;
            // font size & color
            preview.style.fontSize = parseInt(fontSize.value, 10) + 'px';
            fontSizeValue.textContent = fontSize.value;
            preview.style.color = textColor.value;
            textColorValue.textContent = textColor.value;
            // background handling
            if (transparentBg.checked) {
                // transparent background visually - show checkerboard-looking pattern for preview
                preview.style.background = 'repeating-linear-gradient(45deg, #f8f8f8 0, #f8f8f8 10px, #ffffff 10px, #ffffff 20px)';
                statBg.textContent = 'Ø´ÙØ§Ù';
                currentBgInfo.textContent = 'Ø´ÙØ§Ù';
            } else {
                preview.style.background = bgColor.value || '#ffffff';
                statBg.textContent = 'ØµÙ„Ø¨';
                currentBgInfo.textContent = bgColor.value || '#ffffff';
            }
            // alignment
            const currentAlignBtn = document.querySelector('.align-btn.active');
            const align = currentAlignBtn ? currentAlignBtn.dataset.align : 'right';
            preview.style.textAlign = align;
            statAlign.textContent = (align === 'right') ? 'ÙŠÙ…ÙŠÙ†' : (align === 'center') ? 'ÙˆØ³Ø·' : 'ÙŠØ³Ø§Ø±';
            // update preview font info & description
            const ff = fontFamily.value;
            document.getElementById('fontPreviewText').textContent = text || 'Ù…Ø«Ø§Ù„: Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…';
            document.getElementById('fontDescription').innerHTML = `<strong>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${ff}</strong><br>${fontDescriptions[ff] || 'Ø®Ø· Ù…ØªØ§Ø­ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… â€” ØºÙŠÙ‘Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©'}`;
            // statistics
            const chars = countChars(text);
            charCount.textContent = chars;
            statChars.textContent = chars;
            statSize.textContent = fontSize.value + 'px';
        }

        /* ---------- export functions using html2canvas ---------- */
        function downloadCanvasAsPNG(transparent = true) {
            // temporarily remove checkerboard CSS so html2canvas gets correct background
            const prevBg = preview.style.background;
            const useBg = transparent ? null : (bgColor.value || '#ffffff');

            // html2canvas supports backgroundColor option (use null for transparent)
            html2canvas(preview, {
                backgroundColor: useBg,
                scale: Math.min(3, window.devicePixelRatio || 2) // reasonable scale for good quality
            }).then(canvas => {
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = transparent ? 'calligraphy.png' : 'calligraphy_with_bg.png';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    URL.revokeObjectURL(url);
                }, 'image/png');
            }).catch(err => {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© â€” Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø­Ø¯ÙŠØ« Ø£Ùˆ Ø§Ø³ØªØ¶Ù Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù….');
                console.error(err);
            });
        }

        function downloadCanvasAsJPG() {
            // force white background for JPG
            html2canvas(preview, {
                backgroundColor: '#ffffff',
                scale: Math.min(3, window.devicePixelRatio || 2)
            }).then(canvas => {
                const data = canvas.toDataURL('image/jpeg', 0.92);
                const a = document.createElement('a');
                a.href = data;
                a.download = 'calligraphy.jpg';
                document.body.appendChild(a);
                a.click();
                a.remove();
            }).catch(err => {
                alert('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ JPG â€” Ø­Ø§ÙˆÙ„ ÙÙŠ Ù…ØªØµÙØ­ Ø¢Ø®Ø± Ø£Ùˆ Ø§Ø³ØªØ¶Ù Ø§Ù„ØµÙØ­Ø©.');
                console.error(err);
            });
        }

        /* ---------- hook export buttons ---------- */
        downloadPng.addEventListener('click', () => downloadCanvasAsPNG(true));
        downloadJpg.addEventListener('click', () => downloadCanvasAsJPG());

        /* ---------- initial render ---------- */
        // set initial UI values and render
        (function init() {
            // populate quick examples already done above
            // ensure preview displays initial state
            fontSizeValue.textContent = fontSize.value;
            textColorValue.textContent = textColor.value;
            bgColorValue.textContent = bgColor.value;
            updatePreview();
        })();

        /* ---------- Accessibility & keyboard support (optional) ---------- */
        // allow pressing Enter in the textarea to update preview immediately (already automatic), but enable ctrl+enter for quick export if desired
        arabicText.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                // ctrl+enter to export PNG
                downloadCanvasAsPNG(true);
            }
        });
    </script>
</body>
</html>
